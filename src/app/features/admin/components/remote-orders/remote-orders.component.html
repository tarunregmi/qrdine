<div class="admin-menu-page" @fadeIn>
  <div class="row" style="justify-content:space-between">
    <span class="page-title">Remote Orders</span>
  </div>

  <mat-card appearance="outlined" class="table-card">
    <div class="table">
      <table mat-table [dataSource]="remoteOrders_.remote_orders">

        <!-- Items column -->
        <ng-container matColumnDef="items">
          <th mat-header-cell *matHeaderCellDef>Items</th>
          <td mat-cell *matCellDef="let element">
            <table mat-table [dataSource]="element.items" class="sub-table">
              <ng-container matColumnDef="items">
                <th mat-header-cell *matHeaderCellDef colspan="2">Items</th>
                <td mat-cell *matCellDef="let element; let i = index;">{{ element.title }}</td>
              </ng-container>

              <ng-container matColumnDef="sn">
                <td mat-cell *matCellDef="let element; let i = index;">{{ i+1 }}. </td>
              </ng-container>

              <ng-container matColumnDef="qnty">
                <th mat-header-cell *matHeaderCellDef>Qnty.</th>
                <td mat-cell *matCellDef="let element">{{ element.quantity }}</td>
              </ng-container>

              <ng-container matColumnDef="price">
                <th mat-header-cell *matHeaderCellDef>Price</th>
                <td mat-cell *matCellDef="let element">{{ element.price }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="['items', 'qnty', 'price'];"></tr>
              <tr mat-row *matRowDef="let row; columns: ['sn', 'items', 'qnty', 'price'];"></tr>
            </table>
          </td>
        </ng-container>

        <!-- Total cost column -->
        <ng-container matColumnDef="total">
          <th mat-header-cell *matHeaderCellDef>Total</th>
          <td mat-cell *matCellDef="let element">{{ element.totalPrice | npr }}</td>
        </ng-container>

        <!-- Booked delivery address column -->
        <ng-container matColumnDef="deliveryAddress" class="table">
          <th mat-header-cell *matHeaderCellDef>Delivery Address</th>
          <td mat-cell *matCellDef="let element">{{ element.deliveryAddress }}</td>
        </ng-container>

        <!-- Booked user-name column -->
        <ng-container matColumnDef="user">
          <th mat-header-cell *matHeaderCellDef>User</th>
          <td mat-cell *matCellDef="let element">
            {{ element.user?.['name'] }}
            <mat-icon *ngIf="element.user.verified" fontIcon="verified" color="primary" class="verify-icon"></mat-icon>
            <button mat-icon-button (click)="showUserDetails(element.user)" class="i">
              <mat-icon fontIcon="info"></mat-icon>
            </button>
          </td>
        </ng-container>

        <ng-container matColumnDef="created">
          <th mat-header-cell *matHeaderCellDef>Created</th>
          <td mat-cell *matCellDef="let element">
            <span class="date">{{ element.created | date:'hh:mm:ss a' }}</span>
            <br>
            <span class="date">{{ element.created | date:'YYYY-MM-dd' }}</span>
          </td>
        </ng-container>

        <!-- Order state column -->
        <ng-container matColumnDef="state">
          <th mat-header-cell *matHeaderCellDef>State</th>
          <td mat-cell *matCellDef="let element">

            <mat-form-field appearance="outline" subscriptSizing="dynamic" style="margin: 10px 0;" [class]="element.state">
              <mat-select name="state" [(ngModel)]="element.state" [disabled]="element.state === 'cancelled' || element.state === 'completed'" (selectionChange)="onStateChange(element)">
                <mat-option value="pending">Pending</mat-option>
                <mat-option value="confirmed">Confirmed</mat-option>
                <mat-option value="completed">Completed</mat-option>
                <mat-option value="cancelled">Cancelled</mat-option>
              </mat-select>
            </mat-form-field>
            
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; let even=even; columns: displayedColumns;" [ngClass]="{gray: even}"></tr>
      </table>
    </div>
    
    <mat-paginator
      [length]="remoteOrders_.totalItems"
      [pageSize]="remoteOrders_.pageSize"
      hidePageSize="true"
      (page)="changePage($event)">
    </mat-paginator>
  </mat-card>
</div>
